@page "Account/ForgotPassword"
@layout AccountLayout
@inherits AccountBlazorFluentDesignComponentBase
<FluentCard>
    <AbpDialogForm Content="Input" SubmitClick="SubmitAsync">
        <Header>
            <FluentLabel Weight="FontWeight.Bold" Typo="Typography.H2">@L["ForgotPassword"]</FluentLabel>
        </Header>
        <FluentTextField TextFieldType="TextFieldType.Email" @bind-Value="Input.Email"></FluentTextField>
    </AbpDialogForm>
</FluentCard>

@code {
    [SupplyParameterFromQuery] private string? ReturnUrl { get; set; }

    [SupplyParameterFromQuery] private string? ReturnUrlHash { get; set; }


    public SendPasswordResetCodeDto Input { get; set; } = new()
    {
        AppName = "MVC", //TODO: Const!
    };

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            Input.ReturnUrl = ReturnUrl;
            Input.ReturnUrlHash = ReturnUrlHash;
        }
    }

    protected virtual async Task SubmitAsync()
    {
        try
        {
            await AccountAppService.SendPasswordResetCodeAsync(Input);

            var url = NavigationManager.GetUriWithQueryParameters("/Account/PasswordResetLinkSent",
                new Dictionary<string, object>
                {
                    ["returnUrl"] = Input.ReturnUrl,
                    ["returnUrlHash"] = Input.ReturnUrlHash
                });

            NavigationManager.NavigateTo(url, replace: true);
        }
        catch (Exception e)
        {
            await HandleErrorAsync(e);
        }
    }


}